{"componentChunkName":"component---src-templates-blog-post-blog-post-tsx","path":"/blogs/deploy-docker-gcp","result":{"data":{"markdownRemark":{"html":"<h1>Deploy a docker image on GCP Kubernetes Engine</h1>\n<h2>1. Command line tool setup:</h2>\n<ul>\n<li>Install <a href=\"https://cloud.google.com/sdk/docs/quickstart\">gcloud</a> command line tool</li>\n<li>Run <code>gcloud init</code> to login account</li>\n</ul>\n<blockquote>\n<p>View current account:\n<code>gcloud info</code></p>\n</blockquote>\n<blockquote>\n<p>List accounts that’s been added:\n<code>gcloud auth list</code> or\n<code>gcloud config configurations list</code></p>\n</blockquote>\n<blockquote>\n<p>Switch to another account:\n<code>gcloud config set account &#x3C;name>@gmail.com</code></p>\n</blockquote>\n<ul>\n<li>Install kubectl component\n<code>gcloud components install kubectl</code></li>\n</ul>\n<h2>2. Package a sample web application into a Docker image.</h2>\n<p>With command <code>docker build -t gcr.io/${PROJECT_ID}/hello-app:v1 .</code></p>\n<blockquote>\n<p>View images:\n<code>docker images</code></p>\n</blockquote>\n<blockquote>\n<p>Run image:\n<code>docker run —rm -p 8080:8080 gcr.io/${PROJECT_ID}/hello-app:v1</code></p>\n</blockquote>\n<p><code>&#x3C;host port>:&#x3C;container’s port></code></p>\n<h2>3. Upload the Docker image to Container Registry.</h2>\n<ol>\n<li>Enable the <a href=\"https://console.cloud.google.com/apis/library/containerregistry.googleapis.com\">Container Registry API</a></li>\n</ol>\n<pre><code>gcloud services enable containerregistry.googleapis.com\n</code></pre>\n<ol start=\"2\">\n<li>Configure the Docker command-line tool to authenticate to <a href=\"https://cloud.google.com/container-registry\">Container Registry</a>:</li>\n</ol>\n<pre><code class=\"language-shell\">gcloud auth configure-docker\n</code></pre>\n<ol start=\"3\">\n<li>Push the Docker image that you just built to Container Registry:</li>\n</ol>\n<pre><code class=\"language-shell\">docker push gcr.io/${PROJECT_ID}/hello-app:v1\n</code></pre>\n<p><strong>## Deploy the sample app to the cluster</strong></p>\n<p>In *<strong>*cloud shell**</strong>\nSetup local shell’s kubectl:</p>\n<pre><code class=\"language-shell\">gcloud container clusters get-credentials ${CLUSTER_NAME} --region=${region}\n</code></pre>\n<p>Check setup:</p>\n<blockquote>\n<p>Log pods:\n<code>kubectl get pods</code></p>\n</blockquote>\n<p><code>kubectl create deployment hello-app —image=gcr.io/${PROJECT_ID}/hello-app:v1</code></p>\n<p><code>kubectl scale deployment hello-app —replicas=3</code></p>\n<p><code>kubectl autoscale deployment hello-app —cpu-percent=80 —min=1 —max=5</code></p>\n<p>Or using UI:\nClick <code>Deploy</code> Button, and follow the instructions.</p>\n<h2>Expose the sample app to the internet.</h2>\n<ol>\n<li>On UI, click actions->Expose.</li>\n<li>Set target port to application port.</li>\n<li>Service type set to load-balancer.</li>\n<li>Done</li>\n</ol>\n<p>In service tab, External endpoints can be accessed via internet.</p>\n<h2>Deploy a new version of the sample app.</h2>\n<p><code>docker build -t gcr.io/${PROJECT_ID}/hello-app:v2 .</code><br>\n<code>docker push gcr.io/${PROJECT_ID}/hello-app:v2</code></p>\n<p>Rolling update:<br>\nIn console UI:<br>\nActions->Rolling update<br>\nSet new image url</p>\n<h2>Clean up</h2>\n<ol>\n<li>Delete Service</li>\n<li>Delete cluster</li>\n<li>Delete images</li>\n</ol>\n<h2>References:</h2>\n<ul>\n<li><a href=\"https://cloud.google.com/kubernetes-engine/docs/tutorials/hello-app?hl=en_US\">Deploying a containerized web application</a></li>\n</ul>","frontmatter":{"date":"February 20, 2020","path":"/blogs/deploy-docker-gcp","title":"Deploy a docker image on GCP Kubernetes Engine"},"htmlAst":{"type":"root","children":[{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"Deploy a docker image on GCP Kubernetes Engine"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"1. Command line tool setup:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Install "},{"type":"element","tagName":"a","properties":{"href":"https://cloud.google.com/sdk/docs/quickstart"},"children":[{"type":"text","value":"gcloud"}]},{"type":"text","value":" command line tool"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Run "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"gcloud init"}]},{"type":"text","value":" to login account"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"blockquote","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"View current account:\n"},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"gcloud info"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"blockquote","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"List accounts that’s been added:\n"},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"gcloud auth list"}]},{"type":"text","value":" or\n"},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"gcloud config configurations list"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"blockquote","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Switch to another account:\n"},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"gcloud config set account <name>@gmail.com"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Install kubectl component\n"},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"gcloud components install kubectl"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"2. Package a sample web application into a Docker image."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"With command "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"docker build -t gcr.io/${PROJECT_ID}/hello-app:v1 ."}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"blockquote","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"View images:\n"},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"docker images"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"blockquote","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Run image:\n"},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"docker run —rm -p 8080:8080 gcr.io/${PROJECT_ID}/hello-app:v1"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"<host port>:<container’s port>"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"3. Upload the Docker image to Container Registry."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Enable the "},{"type":"element","tagName":"a","properties":{"href":"https://console.cloud.google.com/apis/library/containerregistry.googleapis.com"},"children":[{"type":"text","value":"Container Registry API"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"gcloud services enable containerregistry.googleapis.com\n"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{"start":2},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Configure the Docker command-line tool to authenticate to "},{"type":"element","tagName":"a","properties":{"href":"https://cloud.google.com/container-registry"},"children":[{"type":"text","value":"Container Registry"}]},{"type":"text","value":":"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-shell"]},"children":[{"type":"text","value":"gcloud auth configure-docker\n"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{"start":3},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Push the Docker image that you just built to Container Registry:"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-shell"]},"children":[{"type":"text","value":"docker push gcr.io/${PROJECT_ID}/hello-app:v1\n"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"## Deploy the sample app to the cluster"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"In *"},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"*cloud shell**"}]},{"type":"text","value":"\nSetup local shell’s kubectl:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-shell"]},"children":[{"type":"text","value":"gcloud container clusters get-credentials ${CLUSTER_NAME} --region=${region}\n"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Check setup:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"blockquote","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Log pods:\n"},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"kubectl get pods"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"kubectl create deployment hello-app —image=gcr.io/${PROJECT_ID}/hello-app:v1"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"kubectl scale deployment hello-app —replicas=3"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"kubectl autoscale deployment hello-app —cpu-percent=80 —min=1 —max=5"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Or using UI:\nClick "},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"Deploy"}]},{"type":"text","value":" Button, and follow the instructions."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"Expose the sample app to the internet."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"On UI, click actions->Expose."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Set target port to application port."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Service type set to load-balancer."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Done"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"In service tab, External endpoints can be accessed via internet."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"Deploy a new version of the sample app."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"docker build -t gcr.io/${PROJECT_ID}/hello-app:v2 ."}]},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"docker push gcr.io/${PROJECT_ID}/hello-app:v2"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Rolling update:"},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"\nIn console UI:"},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"\nActions->Rolling update"},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"\nSet new image url"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"Clean up"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Delete Service"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Delete cluster"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Delete images"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"References:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://cloud.google.com/kubernetes-engine/docs/tutorials/hello-app?hl=en_US"},"children":[{"type":"text","value":"Deploying a containerized web application"}]}]},{"type":"text","value":"\n"}]}],"data":{"quirksMode":false}}}},"pageContext":{"prev":{"frontmatter":{"type":null,"date":"2020-02-15T00:00:00.000Z","path":"/blogs/rendering-test","tags":"featured","title":"Blog rendering test","score":100}},"next":{"frontmatter":{"type":null,"date":"2020-02-22T00:00:00.000Z","path":"/blogs/gcp-configure-ssl","tags":"note, backend, gcp","title":"Setup HTTPs for Kubernetes","score":94}},"tags":["note","backend","gcp"]}},"staticQueryHashes":[]}